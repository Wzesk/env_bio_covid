Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 8
Rules claiming more threads will be scaled down.
Conda environments: ignored
Job stats:
job                         count    min threads    max threads
------------------------  -------  -------------  -------------
add_branch_labels               1              1              1
all                             1              1              1
ancestral                       1              1              1
calculate_epiweeks              1              1              1
clades                          1              1              1
distances                       1              1              1
emerging_lineages               1              1              1
export                          1              1              1
finalize                        1              1              1
include_hcov19_prefix           1              1              1
logistic_growth                 1              1              1
mutational_fitness              1              1              1
refine                          1              1              1
rename_emerging_lineages        1              1              1
tip_frequencies                 1              1              1
traits                          1              1              1
translate                       1              1              1
tree                            1              8              8
total                          18              1              8

Select jobs to execute...

[Thu Nov 25 11:05:31 2021]
Job 6: Building tree


        augur tree             --alignment results/new_york/masked.fasta             --tree-builder-args '-ninit 10 -n 4'             --exclude-sites defaults/sites_ignored_for_tree_topology.txt             --output results/new_york/tree_raw.nwk             --nthreads 8 2>&1 | tee logs/tree_new_york.txt
        
[Thu Nov 25 11:43:22 2021]
Finished job 6.
1 of 18 steps (6%) done
Select jobs to execute...

[Thu Nov 25 11:43:23 2021]
rule calculate_epiweeks:
    input: results/new_york/metadata_adjusted.tsv.xz
    output: results/new_york/epiweeks.json
    log: logs/calculate_epiweeks_new_york.txt
    jobid: 42
    benchmark: benchmarks/calculate_epiweeks_new_york.txt
    wildcards: build_name=new_york
    resources: tmpdir=/tmp


        python3 scripts/calculate_epiweek.py             --metadata results/new_york/metadata_adjusted.tsv.xz             --output-node-data results/new_york/epiweeks.json 2>&1 | tee logs/calculate_epiweeks_new_york.txt
        

[Thu Nov 25 11:43:23 2021]
Job 5: 
        Refining tree
          - estimate timetree
          - use opt coalescent timescale
          - estimate marginal node dates
        


        augur refine             --tree results/new_york/tree_raw.nwk             --alignment results/new_york/masked.fasta             --metadata results/new_york/metadata_adjusted.tsv.xz             --output-tree results/new_york/tree.nwk             --output-node-data results/new_york/branch_lengths.json             --root Wuhan/Hu-1/2019             --timetree                          --clock-rate 0.0008             --clock-std-dev 0.0004             --coalescent opt             --date-inference marginal             --divergence-unit mutations             --date-confidence             --no-covariance             --clock-filter-iqd 4 2>&1 | tee logs/refine_new_york.txt
        
[Thu Nov 25 11:43:51 2021]
Finished job 42.
2 of 18 steps (11%) done
[Thu Nov 25 12:55:31 2021]
Finished job 5.
3 of 18 steps (17%) done
Select jobs to execute...

[Thu Nov 25 12:55:32 2021]
Job 31: Translating amino acid sequences


        python3 scripts/explicit_translation.py             --tree results/new_york/tree.nwk             --reference defaults/reference_seq.gb             --translations results/new_york/translations/aligned.gene.ORF1a.fasta results/new_york/translations/aligned.gene.ORF1b.fasta results/new_york/translations/aligned.gene.S.fasta results/new_york/translations/aligned.gene.ORF3a.fasta results/new_york/translations/aligned.gene.E.fasta results/new_york/translations/aligned.gene.M.fasta results/new_york/translations/aligned.gene.ORF6.fasta results/new_york/translations/aligned.gene.ORF7a.fasta results/new_york/translations/aligned.gene.ORF7b.fasta results/new_york/translations/aligned.gene.ORF8.fasta results/new_york/translations/aligned.gene.N.fasta results/new_york/translations/aligned.gene.ORF9b.fasta             --genes ORF1a ORF1b S ORF3a E M ORF6 ORF7a ORF7b ORF8 N ORF9b             --output results/new_york/aa_muts.json 2>&1 | tee logs/aamuts_new_york.txt
        

[Thu Nov 25 12:55:32 2021]
Job 30: 
        Reconstructing ancestral sequences and mutations
          - inferring ambiguous mutations
        


        augur ancestral             --tree results/new_york/tree.nwk             --alignment results/new_york/aligned.fasta             --output-node-data results/new_york/nt_muts.json             --inference joint             --infer-ambiguous 2>&1 | tee logs/ancestral_new_york.txt
        

[Thu Nov 25 12:55:32 2021]
Job 39: Estimating censored KDE frequencies for tips


        augur frequencies             --method kde             --metadata results/new_york/metadata_adjusted.tsv.xz             --tree results/new_york/tree.nwk             --min-date 2020.9030054644809             --max-date 2021.9             --pivot-interval 1             --pivot-interval-units weeks             --narrow-bandwidth 0.05             --proportion-wide 0.0             --output results/new_york/tip-frequencies.json 2>&1 | tee logs/tip_frequencies_new_york.txt
        

[Thu Nov 25 12:55:32 2021]
Job 37: 
        Inferring ancestral traits for ['country']
          - increase uncertainty of reconstruction by 2.5 to partially account for sampling bias
        


        augur traits             --tree results/new_york/tree.nwk             --metadata results/new_york/metadata_adjusted.tsv.xz             --output results/new_york/traits.json             --columns country             --confidence             --sampling-bias-correction 2.5 2>&1 | tee logs/traits_new_york.txt
        
[Thu Nov 25 12:55:56 2021]
Finished job 39.
4 of 18 steps (22%) done
Select jobs to execute...

[Thu Nov 25 12:55:56 2021]
rule logistic_growth:
    input: results/new_york/tree.nwk, results/new_york/tip-frequencies.json
    output: results/new_york/logistic_growth.json
    log: logs/logistic_growth_new_york.txt
    jobid: 38
    benchmark: benchmarks/logistic_growth_new_york.txt
    wildcards: build_name=new_york
    resources: tmpdir=/tmp, mem_mb=256


        python3 scripts/calculate_delta_frequency.py             --tree results/new_york/tree.nwk             --frequencies results/new_york/tip-frequencies.json             --method logistic             --delta-pivots 6             --min-tips 50             --min-frequency 1e-06             --max-frequency 0.95             --attribute-name logistic_growth             --output results/new_york/logistic_growth.json 2>&1 | tee logs/logistic_growth_new_york.txt
        
[Thu Nov 25 12:56:17 2021]
Finished job 38.
5 of 18 steps (28%) done
[Thu Nov 25 12:56:49 2021]
Finished job 37.
6 of 18 steps (33%) done
[Thu Nov 25 13:01:07 2021]
Finished job 31.
7 of 18 steps (39%) done
Select jobs to execute...

[Thu Nov 25 13:01:07 2021]
rule distances:
    input: results/new_york/tree.nwk, results/new_york/translations/aligned.gene.S_withInternalNodes.fasta, defaults/distance_maps/S1.json
    output: results/new_york/distances.json
    jobid: 41
    wildcards: build_name=new_york
    resources: tmpdir=/tmp


        augur distance             --tree results/new_york/tree.nwk             --alignment results/new_york/translations/aligned.gene.S_withInternalNodes.fasta             --gene-names S             --compare-to root             --attribute-name S1_mutations             --map defaults/distance_maps/S1.json             --output results/new_york/distances.json
        

[Thu Nov 25 13:01:07 2021]
rule mutational_fitness:
    input: results/new_york/tree.nwk, results/new_york/translations/aligned.gene.ORF1a_withInternalNodes.fasta, results/new_york/translations/aligned.gene.ORF1b_withInternalNodes.fasta, results/new_york/translations/aligned.gene.S_withInternalNodes.fasta, results/new_york/translations/aligned.gene.ORF3a_withInternalNodes.fasta, results/new_york/translations/aligned.gene.E_withInternalNodes.fasta, results/new_york/translations/aligned.gene.M_withInternalNodes.fasta, results/new_york/translations/aligned.gene.ORF6_withInternalNodes.fasta, results/new_york/translations/aligned.gene.ORF7a_withInternalNodes.fasta, results/new_york/translations/aligned.gene.ORF7b_withInternalNodes.fasta, results/new_york/translations/aligned.gene.ORF8_withInternalNodes.fasta, results/new_york/translations/aligned.gene.N_withInternalNodes.fasta, results/new_york/translations/aligned.gene.ORF9b_withInternalNodes.fasta, defaults/mutational_fitness_distance_map.json
    output: results/new_york/mutational_fitness.json
    log: logs/mutational_fitness_new_york.txt
    jobid: 40
    benchmark: benchmarks/mutational_fitness_new_york.txt
    wildcards: build_name=new_york
    resources: tmpdir=/tmp, mem_mb=2000


        augur distance             --tree results/new_york/tree.nwk             --alignment results/new_york/translations/aligned.gene.ORF1a_withInternalNodes.fasta results/new_york/translations/aligned.gene.ORF1b_withInternalNodes.fasta results/new_york/translations/aligned.gene.S_withInternalNodes.fasta results/new_york/translations/aligned.gene.ORF3a_withInternalNodes.fasta results/new_york/translations/aligned.gene.E_withInternalNodes.fasta results/new_york/translations/aligned.gene.M_withInternalNodes.fasta results/new_york/translations/aligned.gene.ORF6_withInternalNodes.fasta results/new_york/translations/aligned.gene.ORF7a_withInternalNodes.fasta results/new_york/translations/aligned.gene.ORF7b_withInternalNodes.fasta results/new_york/translations/aligned.gene.ORF8_withInternalNodes.fasta results/new_york/translations/aligned.gene.N_withInternalNodes.fasta results/new_york/translations/aligned.gene.ORF9b_withInternalNodes.fasta             --gene-names ORF1a ORF1b S ORF3a E M ORF6 ORF7a ORF7b ORF8 N ORF9b             --compare-to root             --attribute-name mutational_fitness             --map defaults/mutational_fitness_distance_map.json             --output results/new_york/mutational_fitness.json 2>&1 | tee logs/mutational_fitness_new_york.txt
        
[Thu Nov 25 13:01:28 2021]
Finished job 41.
8 of 18 steps (44%) done
[Thu Nov 25 13:01:38 2021]
Finished job 40.
9 of 18 steps (50%) done
[Thu Nov 25 13:02:10 2021]
Finished job 30.
10 of 18 steps (56%) done
Select jobs to execute...

[Thu Nov 25 13:02:11 2021]
Job 33: Adding emerging clade labels


        augur clades --tree results/new_york/tree.nwk             --mutations results/new_york/nt_muts.json results/new_york/aa_muts.json             --clades defaults/emerging_lineages.tsv             --output-node-data results/new_york/temp_emerging_lineages.json 2>&1 | tee logs/emerging_lineages_new_york.txt
        

[Thu Nov 25 13:02:11 2021]
Job 34: Adding internal clade labels


        augur clades --tree results/new_york/tree.nwk             --mutations results/new_york/nt_muts.json results/new_york/aa_muts.json             --clades results/new_york/clades.tsv             --output-node-data results/new_york/clades.json 2>&1 | tee logs/clades_new_york.txt
        
[Thu Nov 25 13:02:34 2021]
Finished job 34.
11 of 18 steps (61%) done
[Thu Nov 25 13:02:34 2021]
Finished job 33.
12 of 18 steps (67%) done
Select jobs to execute...

[Thu Nov 25 13:02:34 2021]
rule rename_emerging_lineages:
    input: results/new_york/temp_emerging_lineages.json
    output: results/new_york/emerging_lineages.json
    jobid: 32
    benchmark: benchmarks/rename_emerging_lineages_new_york.txt
    wildcards: build_name=new_york
    resources: tmpdir=/tmp

[Thu Nov 25 13:02:46 2021]
Finished job 32.
13 of 18 steps (72%) done
Select jobs to execute...

[Thu Nov 25 13:02:46 2021]
Job 4: Exporting data files for for auspice


        augur export v2             --tree results/new_york/tree.nwk             --metadata results/new_york/metadata_adjusted.tsv.xz             --node-data results/new_york/branch_lengths.json results/new_york/nt_muts.json results/new_york/aa_muts.json results/new_york/emerging_lineages.json results/new_york/clades.json results/new_york/recency.json results/new_york/traits.json results/new_york/logistic_growth.json results/new_york/mutational_fitness.json results/new_york/distances.json results/new_york/epiweeks.json             --auspice-config defaults/auspice_config.json             --include-root-sequence             --colors results/new_york/colors.tsv             --lat-longs defaults/lat_longs.tsv             --title 'Genomic epidemiology of novel coronavirus - New_York-focused subsampling'             --description defaults/description.md             --output results/new_york/ncov_with_accessions.json 2>&1 | tee logs/export_new_york.txt
        
[Thu Nov 25 13:03:24 2021]
Finished job 4.
14 of 18 steps (78%) done
Select jobs to execute...

[Thu Nov 25 13:03:24 2021]
Job 3: Adding custom branch labels to the Auspice JSON


        python3 ./scripts/add_branch_labels.py             --input results/new_york/ncov_with_accessions.json             --emerging-clades results/new_york/temp_emerging_lineages.json             --output results/new_york/ncov_with_branch_labels.json
        
[Thu Nov 25 13:03:36 2021]
Finished job 3.
15 of 18 steps (83%) done
Select jobs to execute...

[Thu Nov 25 13:03:36 2021]
Job 2: Rename strains to include hCoV-19/ prefix


        python3 ./scripts/include_prefix.py             --input-auspice results/new_york/ncov_with_branch_labels.json             --input-tip-frequencies results/new_york/tip-frequencies.json             --prefix              --output-auspice results/new_york/ncov_with_hcov19_prefix.json             --output-tip-frequencies results/new_york/tip-frequencies_with_hcov19_prefix.json
        
[Thu Nov 25 13:03:44 2021]
Finished job 2.
16 of 18 steps (89%) done
Select jobs to execute...

[Thu Nov 25 13:03:44 2021]
Job 1: Remove extraneous colorings for main build and move frequencies


        python3 scripts/fix-colorings.py             --input results/new_york/ncov_with_hcov19_prefix.json             --output auspice/ncov_new_york.json 2>&1 | tee logs/fix_colorings_new_york.txt &&
        cp results/new_york/tip-frequencies_with_hcov19_prefix.json auspice/ncov_new_york_tip-frequencies.json &&
        cp results/new_york/ncov_with_accessions_root-sequence.json auspice/ncov_new_york_root-sequence.json
        
[Thu Nov 25 13:03:54 2021]
Finished job 1.
17 of 18 steps (94%) done
Select jobs to execute...

[Thu Nov 25 13:03:54 2021]
localrule all:
    input: auspice/ncov_new_york.json, auspice/ncov_new_york_tip-frequencies.json
    jobid: 0
    resources: tmpdir=/tmp

[Thu Nov 25 13:03:54 2021]
Finished job 0.
18 of 18 steps (100%) done
Complete log: /vortexfs1/omics/env-bio/collaboration/env_bio_covid/ncov/.snakemake/log/2021-11-25T110524.656198.snakemake.log
