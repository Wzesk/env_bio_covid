Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 8
Rules claiming more threads will be scaled down.
Conda environments: ignored
Job stats:
job                         count    min threads    max threads
------------------------  -------  -------------  -------------
add_branch_labels               1              1              1
adjust_metadata_regions         1              1              1
all                             1              1              1
ancestral                       1              1              1
build_align                     1              8              8
calculate_epiweeks              1              1              1
clades                          1              1              1
colors                          1              1              1
combine_samples                 1              1              1
distances                       1              1              1
emerging_lineages               1              1              1
export                          1              1              1
finalize                        1              1              1
include_hcov19_prefix           1              1              1
logistic_growth                 1              1              1
mask                            1              1              1
mutational_fitness              1              1              1
recency                         1              1              1
refine                          1              1              1
rename_emerging_lineages        1              1              1
subsample                       1              1              1
tip_frequencies                 1              1              1
traits                          1              1              1
translate                       1              1              1
tree                            1              8              8
total                          25              1              8

Select jobs to execute...

[Fri Nov 26 23:02:55 2021]
Job 15: 
        Subsample all sequences by 'lineage-focus' scheme for build 'b_lineage' with the following parameters:

         - group by: --group-by year month
         - sequences per group: 
         - subsample max sequences: --subsample-max-sequences 1000
         - min-date: 
         - max-date: 
         - 
         - exclude: 
         - include: 
         - query: --query "(pango_lineage == 'B.1.526' | pango_lineage == 'B.1.526.1' | pango_lineage == 'B.1.526.2')"
         - priority: 
        


        augur filter             --sequences results/filtered_b_1_526.fasta.xz             --metadata results/sanitized_metadata_b_1_526.tsv.xz             --sequence-index results/combined_sequence_index.tsv.xz             --include b1526_profiles/include.txt             --exclude defaults/exclude.txt                                                                 --query "(pango_lineage == 'B.1.526' | pango_lineage == 'B.1.526.1' | pango_lineage == 'B.1.526.2')"                                       --group-by year month                          --subsample-max-sequences 1000                          --output results/b_lineage/sample-lineage-focus.fasta             --output-strains results/b_lineage/sample-lineage-focus.txt 2>&1 | tee logs/subsample_b_lineage_lineage-focus.txt
        
[Fri Nov 26 23:03:16 2021]
Finished job 15.
1 of 25 steps (4%) done
Select jobs to execute...

[Fri Nov 26 23:03:16 2021]
Job 9: 
        Combine and deduplicate FASTAs
        


        augur filter             --sequences results/filtered_b_1_526.fasta.xz             --sequence-index results/combined_sequence_index.tsv.xz             --metadata results/sanitized_metadata_b_1_526.tsv.xz             --exclude-all             --include results/b_lineage/sample-lineage-focus.txt             --output-sequences results/b_lineage/b_lineage_subsampled_sequences.fasta.xz             --output-metadata results/b_lineage/b_lineage_subsampled_metadata.tsv.xz 2>&1 | tee logs/subsample_regions_b_lineage.txt
        
[Fri Nov 26 23:03:36 2021]
Finished job 9.
2 of 25 steps (8%) done
Select jobs to execute...

[Fri Nov 26 23:03:36 2021]
Job 8: 
        Aligning sequences to defaults/reference_seq.fasta
            - gaps relative to reference are considered real
        


        xz -c -d results/b_lineage/b_lineage_subsampled_sequences.fasta.xz | nextalign             --jobs=8             --reference defaults/reference_seq.fasta             --genemap defaults/annotation.gff             --genes ORF1a,ORF1b,S,ORF3a,E,M,ORF6,ORF7a,ORF7b,ORF8,N,ORF9b             --sequences /dev/stdin             --output-dir results/b_lineage/translations             --output-basename aligned             --output-fasta results/b_lineage/aligned.fasta             --output-insertions results/b_lineage/insertions.tsv > logs/align_b_lineage.txt 2>&1
        
[Fri Nov 26 23:03:37 2021]
Finished job 8.
3 of 25 steps (12%) done
Select jobs to execute...

[Fri Nov 26 23:03:37 2021]
Job 7: 
        Mask bases in alignment results/b_lineage/aligned.fasta
          - masking 100 from beginning
          - masking 50 from end
          - masking other sites: 21987 21846
        


        python3 scripts/mask-alignment.py             --alignment results/b_lineage/aligned.fasta             --mask-from-beginning 100             --mask-from-end 50             --mask-sites 21987 21846             --mask-terminal-gaps             --output results/b_lineage/masked.fasta 2> logs/mask_b_lineage.txt
        

[Fri Nov 26 23:03:37 2021]
Job 16: 
        Adjusting metadata for build 'b_lineage'
        


        python3 scripts/adjust_regional_meta.py             --region global             --metadata results/b_lineage/b_lineage_subsampled_metadata.tsv.xz             --output results/b_lineage/metadata_adjusted.tsv.xz 2>&1 | tee logs/adjust_metadata_regions_b_lineage.txt
        
[Fri Nov 26 23:03:46 2021]
Finished job 16.
4 of 25 steps (16%) done
Select jobs to execute...

[Fri Nov 26 23:03:46 2021]
Job 30: Constructing colors file


        python3 scripts/assign-colors.py             --ordering defaults/color_ordering.tsv             --color-schemes defaults/color_schemes.tsv             --output results/b_lineage/colors.tsv             --metadata results/b_lineage/metadata_adjusted.tsv.xz 2>&1 | tee logs/colors_b_lineage.txt
        

[Fri Nov 26 23:03:46 2021]
rule calculate_epiweeks:
    input: results/b_lineage/metadata_adjusted.tsv.xz
    output: results/b_lineage/epiweeks.json
    log: logs/calculate_epiweeks_b_lineage.txt
    jobid: 29
    benchmark: benchmarks/calculate_epiweeks_b_lineage.txt
    wildcards: build_name=b_lineage
    resources: tmpdir=/tmp


        python3 scripts/calculate_epiweek.py             --metadata results/b_lineage/metadata_adjusted.tsv.xz             --output-node-data results/b_lineage/epiweeks.json 2>&1 | tee logs/calculate_epiweeks_b_lineage.txt
        

[Fri Nov 26 23:03:46 2021]
Job 23: Use metadata on submission date to construct submission recency field


        python3 scripts/construct-recency-from-submission-date.py             --metadata results/b_lineage/metadata_adjusted.tsv.xz             --output results/b_lineage/recency.json 2>&1 | tee logs/recency_b_lineage.txt
        
[Fri Nov 26 23:03:52 2021]
Finished job 30.
5 of 25 steps (20%) done
[Fri Nov 26 23:03:55 2021]
Finished job 7.
6 of 25 steps (24%) done
Select jobs to execute...
[Fri Nov 26 23:03:57 2021]
Finished job 23.
7 of 25 steps (28%) done
[Fri Nov 26 23:03:57 2021]
Finished job 29.
8 of 25 steps (32%) done

[Fri Nov 26 23:03:57 2021]
Job 6: Building tree


        augur tree             --alignment results/b_lineage/masked.fasta             --tree-builder-args '-ninit 10 -n 4'             --exclude-sites defaults/sites_ignored_for_tree_topology.txt             --output results/b_lineage/tree_raw.nwk             --nthreads 8 2>&1 | tee logs/tree_b_lineage.txt
        
[Fri Nov 26 23:04:13 2021]
Finished job 6.
9 of 25 steps (36%) done
Select jobs to execute...

[Fri Nov 26 23:04:13 2021]
Job 5: 
        Refining tree
          - estimate timetree
          - use opt coalescent timescale
          - estimate marginal node dates
        


        augur refine             --tree results/b_lineage/tree_raw.nwk             --alignment results/b_lineage/masked.fasta             --metadata results/b_lineage/metadata_adjusted.tsv.xz             --output-tree results/b_lineage/tree.nwk             --output-node-data results/b_lineage/branch_lengths.json             --root Wuhan/Hu-1/2019             --timetree                          --clock-rate 0.0008             --clock-std-dev 0.0004             --coalescent opt             --date-inference marginal             --divergence-unit mutations             --date-confidence             --no-covariance             --clock-filter-iqd 4 2>&1 | tee logs/refine_b_lineage.txt
        
[Fri Nov 26 23:04:42 2021]
Finished job 5.
10 of 25 steps (40%) done
Select jobs to execute...

[Fri Nov 26 23:04:42 2021]
Job 18: Translating amino acid sequences


        python3 scripts/explicit_translation.py             --tree results/b_lineage/tree.nwk             --reference defaults/reference_seq.gb             --translations results/b_lineage/translations/aligned.gene.ORF1a.fasta results/b_lineage/translations/aligned.gene.ORF1b.fasta results/b_lineage/translations/aligned.gene.S.fasta results/b_lineage/translations/aligned.gene.ORF3a.fasta results/b_lineage/translations/aligned.gene.E.fasta results/b_lineage/translations/aligned.gene.M.fasta results/b_lineage/translations/aligned.gene.ORF6.fasta results/b_lineage/translations/aligned.gene.ORF7a.fasta results/b_lineage/translations/aligned.gene.ORF7b.fasta results/b_lineage/translations/aligned.gene.ORF8.fasta results/b_lineage/translations/aligned.gene.N.fasta results/b_lineage/translations/aligned.gene.ORF9b.fasta             --genes ORF1a ORF1b S ORF3a E M ORF6 ORF7a ORF7b ORF8 N ORF9b             --output results/b_lineage/aa_muts.json 2>&1 | tee logs/aamuts_b_lineage.txt
        

[Fri Nov 26 23:04:42 2021]
Job 26: Estimating censored KDE frequencies for tips


        augur frequencies             --method kde             --metadata results/b_lineage/metadata_adjusted.tsv.xz             --tree results/b_lineage/tree.nwk             --min-date 2020.905737704918             --max-date 2021.9027397260274             --pivot-interval 1             --pivot-interval-units weeks             --narrow-bandwidth 0.05             --proportion-wide 0.0             --output results/b_lineage/tip-frequencies.json 2>&1 | tee logs/tip_frequencies_b_lineage.txt
        

[Fri Nov 26 23:04:42 2021]
Job 17: 
        Reconstructing ancestral sequences and mutations
          - inferring ambiguous mutations
        


        augur ancestral             --tree results/b_lineage/tree.nwk             --alignment results/b_lineage/aligned.fasta             --output-node-data results/b_lineage/nt_muts.json             --inference joint             --infer-ambiguous 2>&1 | tee logs/ancestral_b_lineage.txt
        

[Fri Nov 26 23:04:42 2021]
Job 24: 
        Inferring ancestral traits for ['division']
          - increase uncertainty of reconstruction by 2.5 to partially account for sampling bias
        


        augur traits             --tree results/b_lineage/tree.nwk             --metadata results/b_lineage/metadata_adjusted.tsv.xz             --output results/b_lineage/traits.json             --columns division             --confidence             --sampling-bias-correction 2.5 2>&1 | tee logs/traits_b_lineage.txt
        
[Fri Nov 26 23:04:58 2021]
Finished job 26.
11 of 25 steps (44%) done
Select jobs to execute...

[Fri Nov 26 23:04:58 2021]
rule logistic_growth:
    input: results/b_lineage/tree.nwk, results/b_lineage/tip-frequencies.json
    output: results/b_lineage/logistic_growth.json
    log: logs/logistic_growth_b_lineage.txt
    jobid: 25
    benchmark: benchmarks/logistic_growth_b_lineage.txt
    wildcards: build_name=b_lineage
    resources: tmpdir=/tmp, mem_mb=256


        python3 scripts/calculate_delta_frequency.py             --tree results/b_lineage/tree.nwk             --frequencies results/b_lineage/tip-frequencies.json             --method logistic             --delta-pivots 6             --min-tips 50             --min-frequency 1e-06             --max-frequency 0.95             --attribute-name logistic_growth             --output results/b_lineage/logistic_growth.json 2>&1 | tee logs/logistic_growth_b_lineage.txt
        
[Fri Nov 26 23:04:58 2021]
Finished job 24.
12 of 25 steps (48%) done
[Fri Nov 26 23:04:58 2021]
Finished job 18.
13 of 25 steps (52%) done
Select jobs to execute...

[Fri Nov 26 23:04:59 2021]
rule mutational_fitness:
    input: results/b_lineage/tree.nwk, results/b_lineage/translations/aligned.gene.ORF1a_withInternalNodes.fasta, results/b_lineage/translations/aligned.gene.ORF1b_withInternalNodes.fasta, results/b_lineage/translations/aligned.gene.S_withInternalNodes.fasta, results/b_lineage/translations/aligned.gene.ORF3a_withInternalNodes.fasta, results/b_lineage/translations/aligned.gene.E_withInternalNodes.fasta, results/b_lineage/translations/aligned.gene.M_withInternalNodes.fasta, results/b_lineage/translations/aligned.gene.ORF6_withInternalNodes.fasta, results/b_lineage/translations/aligned.gene.ORF7a_withInternalNodes.fasta, results/b_lineage/translations/aligned.gene.ORF7b_withInternalNodes.fasta, results/b_lineage/translations/aligned.gene.ORF8_withInternalNodes.fasta, results/b_lineage/translations/aligned.gene.N_withInternalNodes.fasta, results/b_lineage/translations/aligned.gene.ORF9b_withInternalNodes.fasta, defaults/mutational_fitness_distance_map.json
    output: results/b_lineage/mutational_fitness.json
    log: logs/mutational_fitness_b_lineage.txt
    jobid: 27
    benchmark: benchmarks/mutational_fitness_b_lineage.txt
    wildcards: build_name=b_lineage
    resources: tmpdir=/tmp, mem_mb=2000


        augur distance             --tree results/b_lineage/tree.nwk             --alignment results/b_lineage/translations/aligned.gene.ORF1a_withInternalNodes.fasta results/b_lineage/translations/aligned.gene.ORF1b_withInternalNodes.fasta results/b_lineage/translations/aligned.gene.S_withInternalNodes.fasta results/b_lineage/translations/aligned.gene.ORF3a_withInternalNodes.fasta results/b_lineage/translations/aligned.gene.E_withInternalNodes.fasta results/b_lineage/translations/aligned.gene.M_withInternalNodes.fasta results/b_lineage/translations/aligned.gene.ORF6_withInternalNodes.fasta results/b_lineage/translations/aligned.gene.ORF7a_withInternalNodes.fasta results/b_lineage/translations/aligned.gene.ORF7b_withInternalNodes.fasta results/b_lineage/translations/aligned.gene.ORF8_withInternalNodes.fasta results/b_lineage/translations/aligned.gene.N_withInternalNodes.fasta results/b_lineage/translations/aligned.gene.ORF9b_withInternalNodes.fasta             --gene-names ORF1a ORF1b S ORF3a E M ORF6 ORF7a ORF7b ORF8 N ORF9b             --compare-to root             --attribute-name mutational_fitness             --map defaults/mutational_fitness_distance_map.json             --output results/b_lineage/mutational_fitness.json 2>&1 | tee logs/mutational_fitness_b_lineage.txt
        

[Fri Nov 26 23:04:59 2021]
rule distances:
    input: results/b_lineage/tree.nwk, results/b_lineage/translations/aligned.gene.S_withInternalNodes.fasta, defaults/distance_maps/S1.json
    output: results/b_lineage/distances.json
    jobid: 28
    wildcards: build_name=b_lineage
    resources: tmpdir=/tmp


        augur distance             --tree results/b_lineage/tree.nwk             --alignment results/b_lineage/translations/aligned.gene.S_withInternalNodes.fasta             --gene-names S             --compare-to root             --attribute-name S1_mutations             --map defaults/distance_maps/S1.json             --output results/b_lineage/distances.json
        
[Fri Nov 26 23:04:59 2021]
Finished job 17.
14 of 25 steps (56%) done
Select jobs to execute...

[Fri Nov 26 23:04:59 2021]
Job 20: Adding emerging clade labels


        augur clades --tree results/b_lineage/tree.nwk             --mutations results/b_lineage/nt_muts.json results/b_lineage/aa_muts.json             --clades defaults/emerging_lineages.tsv             --output-node-data results/b_lineage/temp_emerging_lineages.json 2>&1 | tee logs/emerging_lineages_b_lineage.txt
        

[Fri Nov 26 23:04:59 2021]
Job 21: Adding internal clade labels


        augur clades --tree results/b_lineage/tree.nwk             --mutations results/b_lineage/nt_muts.json results/b_lineage/aa_muts.json             --clades results/b_lineage/clades.tsv             --output-node-data results/b_lineage/clades.json 2>&1 | tee logs/clades_b_lineage.txt
        
[Fri Nov 26 23:05:16 2021]
Finished job 25.
15 of 25 steps (60%) done
[Fri Nov 26 23:05:16 2021]
Finished job 28.
16 of 25 steps (64%) done
[Fri Nov 26 23:05:16 2021]
Finished job 27.
17 of 25 steps (68%) done
[Fri Nov 26 23:05:16 2021]
Finished job 20.
18 of 25 steps (72%) done
Select jobs to execute...

[Fri Nov 26 23:05:16 2021]
rule rename_emerging_lineages:
    input: results/b_lineage/temp_emerging_lineages.json
    output: results/b_lineage/emerging_lineages.json
    jobid: 19
    benchmark: benchmarks/rename_emerging_lineages_b_lineage.txt
    wildcards: build_name=b_lineage
    resources: tmpdir=/tmp

[Fri Nov 26 23:05:16 2021]
Finished job 21.
19 of 25 steps (76%) done
[Fri Nov 26 23:05:26 2021]
Finished job 19.
20 of 25 steps (80%) done
Select jobs to execute...

[Fri Nov 26 23:05:26 2021]
Job 4: Exporting data files for for auspice


        augur export v2             --tree results/b_lineage/tree.nwk             --metadata results/b_lineage/metadata_adjusted.tsv.xz             --node-data results/b_lineage/branch_lengths.json results/b_lineage/nt_muts.json results/b_lineage/aa_muts.json results/b_lineage/emerging_lineages.json results/b_lineage/clades.json results/b_lineage/recency.json results/b_lineage/traits.json results/b_lineage/logistic_growth.json results/b_lineage/mutational_fitness.json results/b_lineage/distances.json results/b_lineage/epiweeks.json             --auspice-config defaults/auspice_config.json             --include-root-sequence             --colors results/b_lineage/colors.tsv             --lat-longs defaults/lat_longs.tsv             --title 'Genomic epidemiology of novel coronavirus - B_Lineage-focused subsampling'             --description defaults/description.md             --output results/b_lineage/ncov_with_accessions.json 2>&1 | tee logs/export_b_lineage.txt
        
[Fri Nov 26 23:05:47 2021]
Finished job 4.
21 of 25 steps (84%) done
Select jobs to execute...

[Fri Nov 26 23:05:47 2021]
Job 3: Adding custom branch labels to the Auspice JSON


        python3 ./scripts/add_branch_labels.py             --input results/b_lineage/ncov_with_accessions.json             --emerging-clades results/b_lineage/temp_emerging_lineages.json             --output results/b_lineage/ncov_with_branch_labels.json
        
[Fri Nov 26 23:05:52 2021]
Finished job 3.
22 of 25 steps (88%) done
Select jobs to execute...

[Fri Nov 26 23:05:52 2021]
Job 2: Rename strains to include hCoV-19/ prefix


        python3 ./scripts/include_prefix.py             --input-auspice results/b_lineage/ncov_with_branch_labels.json             --input-tip-frequencies results/b_lineage/tip-frequencies.json             --prefix              --output-auspice results/b_lineage/ncov_with_hcov19_prefix.json             --output-tip-frequencies results/b_lineage/tip-frequencies_with_hcov19_prefix.json
        
[Fri Nov 26 23:05:52 2021]
Finished job 2.
23 of 25 steps (92%) done
Select jobs to execute...

[Fri Nov 26 23:05:52 2021]
Job 1: Remove extraneous colorings for main build and move frequencies


        python3 scripts/fix-colorings.py             --input results/b_lineage/ncov_with_hcov19_prefix.json             --output auspice/ncov_b_lineage.json 2>&1 | tee logs/fix_colorings_b_lineage.txt &&
        cp results/b_lineage/tip-frequencies_with_hcov19_prefix.json auspice/ncov_b_lineage_tip-frequencies.json &&
        cp results/b_lineage/ncov_with_accessions_root-sequence.json auspice/ncov_b_lineage_root-sequence.json
        
[Fri Nov 26 23:05:53 2021]
Finished job 1.
24 of 25 steps (96%) done
Select jobs to execute...

[Fri Nov 26 23:05:53 2021]
localrule all:
    input: auspice/ncov_b_lineage.json, auspice/ncov_b_lineage_tip-frequencies.json
    jobid: 0
    resources: tmpdir=/tmp

[Fri Nov 26 23:05:53 2021]
Finished job 0.
25 of 25 steps (100%) done
Complete log: /vortexfs1/omics/env-bio/collaboration/env_bio_covid/ncov/.snakemake/log/2021-11-26T230248.370647.snakemake.log
